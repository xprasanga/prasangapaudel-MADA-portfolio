---
title: "How do customer demographic factors, purchase-related attributes, and service/incentive factors influence the frequency of purchases of US costumers"
author: "Prasanga Paudel"
format:
  html:
    toc: false
    embed-resources: true
    number-sections: true
    highlight-style: github
    bibliography: ../cite/dataanalysis-references.bib
    csl: ../cite/vancouver-author-date.csl
---


```{r, echo=FALSE, message=FALSE}
# load a few R packages
library(here)
library(knitr)
library(here)
library(readxl)
library(writexl)
library(magrittr)
library(patchwork)
library(kableExtra)
```

**Authors**

-   Prasanga Paudel$^{1}$ (ORCID: 0000-0000-1234-5678)

**Author affiliations**

1.  Davis College of Agricultural Sciences & Natural Resources, Texas Tech University, Lubbock, TX, USA.


$\dagger$ Disclaimer: The opinions expressed in this article are the author's own and don't reflect their employer.

{{< pagebreak >}}

<strong>Abstract</strong>  

_For business looking to create a long-lasting client relationship, boost sales, and customize a successful marketing tactics, it is highly essential to understand the underlying consumer decision making process, especially the patterns behind recurring purchases. Our study studies how customer demographics, purchase-related characteristics, incentive factors, and delivery options affect the frequency of purchase using various econometrics techniques. Based on a dataset of 1120 U.S. consumers, our analysis utilizes Ordinary Least Squares (OLS), and the two-stage least squares (2SLS) approach to make accurate explanations of purchase behavior using age, gender, income, amount spent, ratings, season, promotions, subscription, and purchase history._

_Results from our OLS estimation revealed that age, income, previous purchases, and buying fashion related items positively and significantly influence their purchase behavior. On the other hand, males and consumers who spend more per transactions tend to purchase less frequently. Seasonal patterns are also indicated, with significantly higher purchases during spring and winter. The 2SLS approach confirmed that subscription is endogenous, and once corrected, it’s effect seems to be statistically insignificant._

_Our findings highlight the importance of behavioral history and demographic targeting as effective source of increasing purchase frequencies. Furthermore, business should focus on personalized promotions, habit-based incentives and time-sensitive marketing campaigns to promote repeated purchase and higher revenue._

_Keywords: customer behavior, promos, purchase frequency_

{{< pagebreak >}}

# Introduction

Understanding about the dynamic consumer behaviour, specially the patterns underlying their repeated purchase is a key component to the success of any industry and business sector. Consumers sometimes act like creatures of habit, automatically repeating past behavior with little regard to current goals and valued outcomes [@Wood2009-qr]. Purchase and consumption behaviors in daily life often are repetitive and performed in customary places, leading consumers to develop habits [@Ji2007-te]. If a business firm manages to understand the reason behind why consumers act in certain way, then it might open a gateway into more consumer persuasion and increase in revenue. Studies on the effect of demographic factors (age, gender, income) on consumption and purchase frequency have been conducted repeatedly in the past. [@saleh2013impact] for instance, performed a cross-sectional study analyzing the effect of gender, age, and income on consumer’s purchasing responsiveness to free product samples. Results showed that young consumers and females tend to be more responsive to such promotions and income had an insignificant effect. On the other hand, a study by [@Ihsan_Ullah2021-gr] report that there is a weak or no relationship between consumer’s purchase decisions and their demographic attributes, depending on the context.

Business are always trying to come up with new ideas to generate more revenue and profit, but not all attempts are equally fruitful. Promo coupons are also one of such widely used in service establishments, even though little is known about a coupon’s impact on consumer behavior [@Taylor2001-qy]. Recent studies show that coupons and promotions can significantly influence purchase behavior, particularly in prompting repeat or earlier-than-planned purchase decisions [@Balakrishnan2020-oi]. A recent study by [@Poisson2018-zg] studied the effectiveness of coupons on the restaurant consumers’ purchase decision and another study by [@Mishra2024-hd] studied  the impact of sales promotion on consumer buying behavior in the apparel industry. Digital era studies of online shoppers have also found that spending and purchase frequency often vary with age, income, and prior shopping patterns [@Kooti2015-us]. Similary, [@Hu2008-ao] argues that online reviews and rating affect the purchase of that product although it tends to diminish over time. One might think that purchase decisions are also influenced by the seasonal patterns of offers such as Black Friday, Cyber Monday, Summer sales, etc. Ignoring seasonal patterns in consumer’s expectations leads to biased demand estimates [@Soysal2012-le]. And while [@Iyengar2022-ze] report that subscription leads to increase in consumer purchases, two third of the effect is reported to be due to non-economic benefit of the subscription. On the other hand, critiques of subscription sales such as [@Chen2024-mq] argue that effect of subscription is endogenous and it may not always increase sales as there is also a common trend of enrolling into certain subscription just because of peer influence and not much motivation to purchase.

There has been limited work combining a comprehensive set of determinants: demographic variables, purchase history, product attributes, incentives, and seasonal/contextual factors in a single model to explain purchase frequency. Following their previous studies, we want to study various consumer behaviour with detailed insights into consumer responses and shopping patterns across various demographics, locations, and product categories.

# Research Objective

Our broad objective is to empirically examine the effect of different socio-economic, demographic, and product related attributes on purchase frequency. We will evaluate and try to reject/validate behavioral and loyalty theories and try to provide data-supported guidance and retail strategies. We have the following specific objectives.

•	To analyze the relationship between age, gender, item category, seasonality, income with purchase frequency.
•	To assess whether behavioral history significantly predict current purchase frequency
•	To investigate if subscription or use of promo codes is associated with a higher purchase frequency.


# Data source

The “Consumer Behavior and Shopping Habits” dataset that we will be using can provide us with information crucial for market analysis and tailored marketing strategies. The dataset consists of 16 variables and covers a dynamic range of consumer information from all over US. The total number of observations in our sample is 1120. 

	The dataset includes information such as: 
•	Customer demographics (age, gender, location, season)
•	Product details (item purchased, category)
•	Purchase information (amount spent in USD, shipping type)
•	Shopping behaviour (frequency of purchases, previous purchases, subscription status, discount usage, promo usage)


{{< pagebreak >}}

# Methods


We will follow the strategic framework defined by [@kidane2016factors] to describe how consumer’s  purchasing decision is affected by different factors such as shipping methods, services, social and individual attributes, satisfactions. We will assume that the consumer purchase decisions, specifically, consumer’s purchase frequency is defined by the following regression model.

Our objective is to explain the frequency of total purchases made in a year based on age, gender, income, promotional offers, product rating, season, previous purchase history and shipping. We will use the following linear OLS model as our base model.


$Purchase Frequency_i$ = $β_1$ + $β_2 Age_i$ + $β_3 〖Male〗_i$ + $β_4 〖Fashion〗_i$ + $β_5 〖Amount〗_i$ + $β_6 Rating〗_i$ + $β_7 Subscription_i$ + $β_8 Shipping_i$ + $β_9 Promo$ + $β_10 PreviousPurchase_i$ + $β_11 Income_i$ + $β_12 〖Spring〗_i$ + $β_13 Summer_i$ + $β_14 Winter_i$ + $μ_i$ 

Where i represents the individual, age represents the age of the individual in years, Male is a dummy variable which equals one for male, Fashion represents a dummy variable which equals one if the purchased product is related to beauty and fashion, Amount is a continuous variable representing the amount per purchase, Rating represents a continuous variable with a value between 0 and 5, Subscription is a dummy variable that equals one if the individual has a subscription, Promo is a dummy variable that equals one if promo code was used during purchase, Previous purchase represents the total purchases made in previous year, Income is a continuous variable and the seasons are a dummy for the respective season when the purchase was done.

We have the following options for estimation: OLS, OLS (with robust SE), IV-reg


{{< pagebreak >}}






```{r}
set.seed(101)
n <- 1120

# Simulate other predictors
age_raw <- round(rnorm(n, 35, 10))
age <- pmax(age_raw, 18)
gender <- sample(c("Male","Female"), n, replace=TRUE)
item <- sample(c("Blouse","Sweater","Jeans","Shoes","Hat"), n, replace=TRUE)
item_fashion <- ifelse(item %in% c("Blouse","Sweater","Jeans","Hat"),1,0)
amount <- round(pmax(rnorm(n, 70, 30), 0), 2)
rating <- round(runif(n, 2, 5),1)
shipping <- sample(c("Standard","Express"), n, replace=TRUE)
discount <- sample(c(0,1), n, replace=TRUE)
promo <- sample(c(0,1), n, replace=TRUE)
prev_purchases <- rpois(n,5)
income <- round(pmax(rnorm(n, 50000, 15000),0),2)
online_activity <- round(pmax(rnorm(n,50,20),0),2)
season <- sample(c("Winter","Spring","Summer","Autumn"), n, replace=TRUE)

# Create instrument: marketing offer (binary)
marketing_offer <- rbinom(n, 1, 0.4)  # 40% received offer

# Simulate endogenous subscribed variable
# True probability depends on marketing_offer and unobserved factor correlated with frequency
unobserved <- rnorm(n, 0, 1)
logit_subscribed <- -1 + 7*marketing_offer + 0.5*item_fashion + 0.5*prev_purchases + 0.7*unobserved
prob_subscribed <- 1/(1 + exp(-logit_subscribed))
subscribed <- rbinom(n, 1, prob_subscribed)

# Simulate purchase frequency (numeric)
# Frequency depends on age, gender, item_fashion, rating, shipping, discount, promo, prev_purchases
# Also depends on subscribed (true effect = 1.5), but we include noise correlated with subscribed to induce endogeneity
freq_error <- rnorm(n,0,1.5)
frequency_num <- 0.03*age - 0.3*(gender=="Male") + 1*item_fashion -0.005*amount + 0.5*rating +
                 0.2*(shipping=="Express") + 0.2*promo + 0.3*prev_purchases +
                 0.0003*income +
                 0.5*(season=="Winter") + 0.2*(season=="Spring") + 0.1*(season=="Summer") +
                 0.015*subscribed + 3.485*unobserved + 1*freq_error

frequency_num <- round(frequency_num, digits = 0)

# Combine into dataframe
shopping_iv <- data.frame(
  age, gender, item, item_fashion, amount, rating,
  subscribed, shipping, discount, promo, prev_purchases,
  income, online_activity, season, frequency_num, marketing_offer
)

# Quick check
summary(shopping_iv$subscribed)
summary(shopping_iv$frequency_num)
cor(shopping_iv$subscribed, freq_error) # non-zero correlation → endogeneity

```



#Regression

```{r}
library(AER)  # for ivreg

# OLS regression (biased due to endogeneity)
model_ols_sub <- lm(frequency_num ~ age + gender + item_fashion + amount + rating +
                      subscribed + shipping + promo + prev_purchases +
                      income + season,
                    data=shopping_iv)
summary(model_ols_sub)


first_stage <- lm(subscribed ~ marketing_offer + age + gender + item_fashion + amount + rating +
                       + shipping + promo + prev_purchases +
                      income + season,
                    data=shopping_iv)
summary(first_stage)

# IV regression (2SLS) using marketing_offer as instrument for subscribed
model_iv_sub <- ivreg(frequency_num ~ age + gender + item_fashion + amount + rating +
                        subscribed + shipping + promo + prev_purchases +
                        income + season
                      | age + gender + item_fashion + amount + rating +
                        shipping + promo + prev_purchases +
                        income + season + marketing_offer,
                      data=shopping_iv)

summary(model_iv_sub, diagnostics=TRUE)


```



```{r}
# Install packages if needed
# install.packages(c("AER","sandwich","lmtest","broom","flextable","officer"))

library(AER)        # for ivreg
library(sandwich)   # for robust SE
library(lmtest)     # coeftest
library(broom)      # tidy()
library(flextable)  # tables
library(officer)    # Word export

# -------------------------------
# 1️⃣ OLS Regression (normal SE)
# -------------------------------
ols_tidy <- tidy(model_ols_sub)
ols_tidy$model <- "OLS"



# -------------------------------
# 2️⃣ OLS Regression with Robust SE
# -------------------------------
robust_se <- coeftest(model_ols_sub, vcov = vcovHC(model_ols_sub, type = "HC1"))

ols_robust_tidy <- data.frame(
  term = rownames(robust_se),
  estimate = robust_se[, "Estimate"],
  std.error = robust_se[, "Std. Error"],
  statistic = robust_se[, "t value"],
  p.value = robust_se[, "Pr(>|t|)"],
  model = "OLS (Robust SE)"
)



# -------------------------------
# 3️⃣ IV Regression (2SLS)
# -------------------------------
iv_tidy <- tidy(model_iv_sub)
iv_tidy$model <- "IV (2SLS)"

# Round values
iv_tidy$estimate <- round(iv_tidy$estimate,3)
iv_tidy$std.error <- round(iv_tidy$std.error,3)
iv_tidy$statistic <- round(iv_tidy$statistic,3)
iv_tidy$p.value <- round(iv_tidy$p.value,3)


```


```{r}
# Install packages if not installed
# install.packages(c("nlme", "broom", "flextable", "officer"))

library(nlme)
library(broom)
library(flextable)
library(officer)

# 1️⃣ Fit a Generalized Least Squares (GLS) model
# Here we model heteroskedasticity as a function of purchase amount (a reasonable proxy)
gls_model <- gls(frequency_num ~ age + gender + item_fashion + amount + rating +
                   subscribed + shipping + promo + prev_purchases +
                   income + season,
                 data = shopping_iv,
                 weights = varExp(form = ~ amount))


```

# Model Diag 

```{r}
# 1️⃣ Load necessary packages
library(car)      # for VIF
library(lmtest)   # for Breusch-Pagan test
library(sandwich) # robust SE if needed

# -------------------------------
# 2️⃣ Extract residuals and fitted values
residuals_ols <- residuals(model_ols_sub)
fitted_ols <- fitted(model_ols_sub)

# -------------------------------
# 3️⃣ Linearity & Homoskedasticity
# Residuals vs Fitted plot
plot(fitted_ols, residuals_ols,
     xlab="Fitted Values", ylab="Residuals",
     main="Residuals vs Fitted")
abline(h=0, col="red")

# Breusch-Pagan test for heteroskedasticity
bptest(model_ols_sub)
# p-value > 0.05 → homoskedasticity not rejected

# -------------------------------
# 4️⃣ Normality of residuals
# QQ plot
qqnorm(residuals_ols)
qqline(residuals_ols, col="red")

# Shapiro-Wilk test
shapiro.test(residuals_ols)
# p-value > 0.05 → residuals approx normal

# -------------------------------
# 5️⃣ Multicollinearity
vif_values <- vif(model_ols_sub)
vif_values
# VIF > 5 → moderate multicollinearity
# VIF > 10 → severe multicollinearity

```


```{r}
# Install required packages if not already installed
# install.packages(c("dplyr", "psych", "flextable", "officer"))

library(dplyr)
library(psych)
library(flextable)
library(officer)

# 1️⃣ Select only numeric variables
numeric_vars <- shopping_iv %>%
  select_if(is.numeric)

# 2️⃣ Compute descriptive statistics
desc_stats <- psych::describe(numeric_vars) %>%
  as.data.frame() %>%
  select(mean, sd, min, max, median, skew, kurtosis, n)

# 3️⃣ Round to 3 decimals
desc_stats <- round(desc_stats, 3)

# Add variable names as a column
desc_stats$Variable <- rownames(desc_stats)
rownames(desc_stats) <- NULL
desc_stats <- desc_stats[, c("Variable", "mean", "sd", "min", "max", "median", "skew", "kurtosis", "n")]


```



```{r}
# Install if needed
# install.packages(c("dplyr", "ggplot2", "reshape2", "flextable", "officer"))

library(dplyr)
library(ggplot2)
library(reshape2)
library(flextable)
library(officer)

# 1️⃣ Prepare numeric dataset for correlation
independent_vars <- shopping_iv %>%
  select(age, item_fashion, amount, rating,
         subscribed, promo, prev_purchases, income)  # purely numeric ones

# 2️⃣ Compute correlation matrix
corr_matrix <- round(cor(independent_vars, use = "pairwise.complete.obs"), 3)

# 3️⃣ Create a long-format dataset for plotting
corr_long <- melt(corr_matrix)
colnames(corr_long) <- c("Var1", "Var2", "Correlation")

# 4️⃣ Plot correlation heatmap
corr_plot <- ggplot(corr_long, aes(x = Var1, y = Var2, fill = Correlation)) +
  geom_tile(color = "white") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "orange", midpoint = 0) +
  theme_minimal() +
  labs(title = "Correlation Heatmap of Independent Variables",
       x = "", y = "") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

